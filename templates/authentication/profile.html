{% extends 'index.html' %}

{% block additional_styles %}
    <style>
    .columns-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
    }

    .column {
        flex: 1;
        margin: 10px;
    }

    .game {
        border: 1px solid #000;
        padding: 10px;
        margin: 10px 0;
        text-align: center;
        box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        position: relative;
    }
    .game:hover {
        box-shadow: 0 5px 15px rgba(0,0,0,0.5);
    }

    .delete-game {
        position: absolute;
        top: 10px;
        right: 10px;
        border: none;
        background: none;
    }

    </style>
{% endblock %}

{% block content %}
    <form method="post">
    {% csrf_token %}
    </form>
<h2>Profile</h2>

<div class="columns-container">
    <div id="playing" class="column">
        <h3>Playing Now</h3>
        {% for user_game in playing_games %}
        <div class="game" data-id="{{ user_game.game.id }}">
            {{ user_game.game.title }}
            <button class="delete-game">&#x2715;</button>  <!-- Replace this line -->
        </div>
        {% endfor %}
    </div>

    <div id="will_play" class="column">
        <h3>Will Play</h3>
        {% for user_game in will_play_games %}
        <div class="game" data-id="{{ user_game.game.id }}">
            {{ user_game.game.title }}
            <button class="delete-game">&#x2715;</button>  <!-- Replace this line -->
        </div>
        {% endfor %}
    </div>

    <div id="finished" class="column">
        <h3>Finished</h3>
        {% for user_game in finished_games %}
        <div class="game" data-id="{{ user_game.game.id }}">
            {{ user_game.game.title }}
            <button class="delete-game">&#x2715;</button>  <!-- Replace this line -->
        </div>
        {% endfor %}
    </div>
</div>
<a href="{% url 'games:add_game' %}" class="btn btn-primary">Add Game</a>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
<script>
$(function() {
    function makeDraggable(element) {
        element.draggable({
            revert: "invalid",
            helper: function() {
                // Create a new game element without the delete button
                return $('<div>').addClass('game').data('id', $(this).data('id')).text($(this).text());
            }
        });
    }

    makeDraggable($(".game"));

    $(".column").droppable({
        accept: ".game",
        drop: function(event, ui) {
            var game_id = ui.helper.data('id');
            var status = $(this).attr('id');
            var droppableElement = $(this);

            // Send AJAX request to server to update game status
            $.ajax({
                url: '{% url 'games:update_game_status' %}',  // replace with the actual URL of your view
                method: 'POST',
                data: {
                    'game_id': game_id,
                    'status': status,
                    'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val(),
                },
                success: function(data) {
                    // Create a new game element with the same content as the dragged game
                    var newGame = $('<div>').addClass('game').data('id', game_id).text(ui.helper.text());

                    // Create a new delete button
                    var deleteButton = $('<button>').addClass('delete-game').html('&#x2715;');

                    // Append the delete button to the new game
                    newGame.append(deleteButton);

                    // Append the new game to the column
                    newGame.appendTo(droppableElement);

                    // Make the new game draggable
                    makeDraggable(newGame);

                    // Remove the original game from its original column
                    ui.draggable.remove();
                }
            });
        }
    });
});
</script>

{% endblock %}